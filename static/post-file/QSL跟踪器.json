{"name":"QSL跟踪器","nodes":[{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":2}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[208,304],"id":"7464cf20-578d-4e08-9489-cb31118281b5","name":"Schedule Trigger"},{"parameters":{"fromEmail":"BA4SAK QSL Service <noreply@ning.moe>","toEmail":"={{ $json[\"电子邮件\"] }}","subject":"BA4SAK QSL 寄出通知/BA4SAK QSL Sending out notifications","html":"=<!DOCTYPE html>\n<html lang=\"zh\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>QSL 卡片寄出通知</title>\n  <style>\n    body {\n      font-family: 'Arial', sans-serif;\n      line-height: 1.6;\n      color: #333;\n      padding: 20px;\n      background-color: #f9f9f9;\n      margin: 0;\n      max-width: 600px;\n      margin: auto;\n    }\n    h2 {\n      color: #2c3e50;\n      font-size: 24px;\n      text-align: center;\n    }\n    p {\n      font-size: 16px;\n      color: #333;\n      margin-bottom: 15px;\n    }\n    strong {\n      color: #2980b9;\n    }\n    ul {\n      list-style-type: disc;\n      margin-left: 20px;\n    }\n    a {\n      color: #2980b9;\n      text-decoration: none;\n    }\n    a:hover {\n      text-decoration: underline;\n    }\n    footer {\n      font-size: 0.9em;\n      color: #666;\n      text-align: center;\n    }\n    hr {\n      margin: 40px 0;\n      border: 0;\n      border-top: 1px solid #ddd;\n    }\n  </style>\n</head>\n<body>\n  <h2>📮 QSL 卡片寄出通知</h2>\n  <p>您好，{{ $json[\"呼号\"] }}，</p>\n  <p>我已于 <strong>{{ $json['寄出时间'] }}</strong>（北京时间，UTC+8）通过平信方式向您寄出 QSL 卡片。</p>\n  <p>如果您在收到此邮件后：</p>\n  <ul>\n    <li>位于中国大陆，请等待最多 <strong>30 天</strong>；</li>\n    <li>位于港澳台或国际地区，请等待最多 <strong>90 天</strong>。</li>\n  </ul>\n  <p>若超过上述时间仍未收到，请通过 <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">QRZ 页面</a> 联系我，我将为您重新寄送一张新的 QSL 卡片。</p>\n  <p>我的呼号是 <strong>BA4SAK</strong>，感谢您的联络（QSO）！73！</p>\n  <p>QSL 卡片背面有一个二维码，请扫码完成收卡片的回执。</p>\n  <footer>\n    <p>本邮件由系统自动发送，请勿直接回复。如有任何疑问，请使用 <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">QRZ 页面</a> 上的邮箱地址与我联系。</p>\n  </footer>\n\n  <hr>\n\n  <h2>📮 QSL Card Dispatch Notification</h2>\n  <p>Hello {{ $json['呼号'] }},</p>\n  <p>I have mailed your QSL card on <strong>{{ $json['寄出时间'] }}</strong> (UTC+8) via standard postal service.</p>\n  <p>Please allow up to:</p>\n  <ul>\n    <li><strong>30 days</strong> for delivery within Mainland China;</li>\n    <li><strong>90 days</strong> for international addresses, including Hong Kong, Macau, and Taiwan.</li>\n  </ul>\n  <p>If you haven’t received your QSL card by then, feel free to contact me via <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">my QRZ page</a> for a re-send.</p>\n  <p>My callsign is <strong>BA4SAK</strong>. Thank you for the QSO! 73!</p>\n  <p>There is a QR code on the back of the QSL card. Please scan it to complete the card receipt confirmation.</p>\n  <footer>\n    <p>This is an automated message. Please do not reply to this email. For any questions, kindly contact me through the email listed on <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">my QRZ page</a>.</p>\n  </footer>\n</body>\n</html>","options":{}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1088,208],"id":"e04ffcb0-fdf4-4dff-b7d4-cc56f814b47a","name":"通知收信人","webhookId":"59137653-36bb-4c2e-be16-7b5173fb18fe","credentials":{"smtp":{"id":"Jb9MEB3Hd3vMBzGg","name":"SMTP account"}}},{"parameters":{"assignments":{"assignments":[{"id":"866a22fd-d525-4a27-9d1b-948a2135c006","name":"呼号","value":"={{ $json.properties['呼号'].title[0].text.content }}","type":"string"},{"id":"19b49cf3-b465-4f37-b042-2fd1ef4687b9","name":"状态","value":"={{ $json.properties['寄出状态'].status.name }}","type":"string"},{"id":"8f1556ef-3c39-467b-aea9-8ac82bc0a29d","name":"电子邮件","value":"={{ $json.properties['电子邮件'].email }}","type":"string"},{"id":"6365ec39-d99f-468b-b541-5d385807de69","name":"邮件状态","value":"={{ $json.properties['发送状态'].status.name }}","type":"string"},{"id":"4d2792f5-6960-403d-839f-40ed180ff179","name":"寄出时间","value":"={{ $json.properties['寄送时间'].date.start }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[640,304],"id":"1c016612-4249-4832-9adf-9e05d0766ba2","name":"整合收件人数据"},{"parameters":{"resource":"databasePage","operation":"getAll","databaseId":{"__rl":true,"value":"https://www.notion.so/misakashell/1ede13b7739f80fe86f9e3832ae3145f","mode":"url"},"returnAll":true,"simple":false,"options":{}},"type":"n8n-nodes-base.notion","typeVersion":2.2,"position":[432,304],"id":"07bc2b58-8802-4206-ba12-b0274e271c2d","name":"获取数据源","alwaysOutputData":true,"notesInFlow":false,"retryOnFail":true,"maxTries":5,"credentials":{"notionApi":{"id":"PAx2VdaqwdzdGW6F","name":"Notion"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"86d63fe9-856b-46d0-bcda-61f43841eae2","leftValue":"={{ $json.properties['发送状态'].status.name }}","rightValue":"未发送","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"f73bcfff-1fc3-4b8c-a66b-53a7fffabdea","leftValue":"={{ $json.properties['寄出状态'].status.name }}","rightValue":"已寄出","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[640,112],"id":"95a4bf7b-cd1e-4a29-8500-7ec9c00e4d36","name":"过滤更改收件人数据"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"64757d7f-0344-47b3-b4cf-e171a192969d","leftValue":"={{ $json[\"状态\"] }}","rightValue":"已寄出","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"a9a0d1b0-dbfa-4018-a163-a3cfffe53bab","leftValue":"={{ $json[\"邮件状态\"] }}","rightValue":"未发送","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[864,304],"id":"a33a2bf6-03d5-44ca-a09b-e7a1ccd6566d","name":"过滤收件人数据"},{"parameters":{"fromEmail":"QSL任务汇总 <noreply@ning.moe>","toEmail":"i@ning.moe","subject":"QSL 通知汇总","html":"={{ $json.htmlContent }}","options":{}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1312,400],"id":"ea36a94a-d23f-4eab-b8d3-7c408920ba94","name":"任务成功通知我","webhookId":"d3cc617f-1590-413a-9704-7a951282c018","credentials":{"smtp":{"id":"Jb9MEB3Hd3vMBzGg","name":"SMTP account"}}},{"parameters":{"jsCode":"const items = $input.all();\nlet rows = \"\";\n\nfor (const item of items) {\n  const 呼号 = item.json[\"呼号\"];\n  const 状态 = item.json[\"状态\"];\n  const 时间 = item.json[\"寄出时间\"];\n  rows += `<tr><td>${呼号}</td><td>${状态}</td><td>${时间}</td></tr>\\n`;\n}\n\nconst html = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <style>\n      body { font-family: Arial, sans-serif; line-height: 1.6; }\n      table { border-collapse: collapse; width: 100%; margin-top: 16px; }\n      th, td { border: 1px solid #dddddd; padding: 8px; text-align: left; }\n      th { background-color: #f2f2f2; }\n    </style>\n  </head>\n  <body>\n    <h2>寄出数据汇总</h2>\n    <p>以下呼号已完成寄出并发送邮件：</p>\n    <table>\n      <tr>\n        <th>呼号</th>\n        <th>状态</th>\n        <th>寄出时间</th>\n      </tr>\n      ${rows}\n    </table>\n  </body>\n</html>\n`;\n\nreturn [{ json: { htmlContent: html } }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1088,400],"id":"29bf1ef8-286d-46c6-97b2-5396538e92ef","name":"Code"},{"parameters":{"assignments":{"assignments":[{"id":"866a22fd-d525-4a27-9d1b-948a2135c006","name":"呼号","value":"={{ $json.properties['呼号'].title[0].text.content }}","type":"string"},{"id":"19b49cf3-b465-4f37-b042-2fd1ef4687b9","name":"状态","value":"={{ $json.properties['我是否收到对方'].status.name }}","type":"string"},{"id":"8f1556ef-3c39-467b-aea9-8ac82bc0a29d","name":"电子邮件","value":"={{ $json.properties['电子邮件'].email }}","type":"string"},{"id":"4d2792f5-6960-403d-839f-40ed180ff179","name":"收到时间","value":"={{ $json.properties[\"收到时间\"].date.start }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,608],"id":"bcd2638f-dc0d-4bfd-9a9d-6ecdf068531a","name":"整合收件人数据1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"86d63fe9-856b-46d0-bcda-61f43841eae2","leftValue":"={{ $json.properties[\"我是否收到对方\"].status.name }}","rightValue":"已收到","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"f73bcfff-1fc3-4b8c-a66b-53a7fffabdea","leftValue":"={{ $json.properties[\"收-发送状态\"].status.name }}","rightValue":"未发送","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.filter","typeVersion":2.2,"position":[640,704],"id":"2293a643-eeac-452b-8b87-c6eee306b4f4","name":"过滤更改收件人数据1"},{"parameters":{"fromEmail":"BA4SAK QSL Service <noreply@ning.moe>","toEmail":"={{ $json[\"电子邮件\"] }}","subject":"【BA4SAK】已收到您的QSL卡片确认通知 / [BA4SAK] QSL Card Received Confirmation","html":"=<!DOCTYPE html>\n<html lang=\"zh\">\n<head>\n  <meta charset=\"UTF-8\" />\n  <title>QSL 卡片收到通知</title>\n  <style>\n    body {\n      font-family: 'Arial', sans-serif;\n      line-height: 1.6;\n      color: #333;\n      padding: 20px;\n      background-color: #f9f9f9;\n      margin: 0;\n      max-width: 600px;\n      margin: auto;\n    }\n    h2 {\n      color: #2c3e50;\n      font-size: 24px;\n      text-align: center;\n    }\n    p {\n      font-size: 16px;\n      color: #333;\n      margin-bottom: 15px;\n    }\n    strong {\n      color: #2980b9;\n    }\n    a {\n      color: #2980b9;\n      text-decoration: none;\n    }\n    a:hover {\n      text-decoration: underline;\n    }\n    footer {\n      font-size: 0.9em;\n      color: #666;\n      text-align: center;\n    }\n    hr {\n      margin: 40px 0;\n      border: 0;\n      border-top: 1px solid #ddd;\n    }\n  </style>\n</head>\n<body>\n  <h2>📬 收到 QSL 卡片通知</h2>\n  <p>您好，{{ $json[\"呼号\"] }}，</p>\n  <p>我已于 <strong>{{ $json['收到时间'] }}</strong>（北京时间，UTC+8）收到了您寄来的 QSL 卡片。</p>\n  <p>非常感谢您的确认和寄送，期待未来有更多精彩的联络（QSO）！</p>\n  <p>如果您还有其他需要，欢迎随时通过 <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">QRZ 页面</a> 与我联系。</p>\n  <p>我的呼号是 <strong>BA4SAK</strong>，祝您通信顺利，73！</p>\n  <footer>\n    <p>本邮件由系统自动发送，请勿直接回复。如有任何疑问，请使用 <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">QRZ 页面</a> 上的邮箱地址与我联系。</p>\n  </footer>\n\n  <hr>\n\n  <h2>📬 QSL Card Received Notification</h2>\n  <p>Hello {{ $json['呼号'] }},</p>\n  <p>I have received your QSL card on <strong>{{ $json['收到时间'] }}</strong> (UTC+8).</p>\n  <p>Thank you very much for your confirmation and sending. Looking forward to more great QSOs in the future!</p>\n  <p>If you need anything else, feel free to contact me via <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">my QRZ page</a>.</p>\n  <p>My callsign is <strong>BA4SAK</strong>. Wishing you successful communications, 73!</p>\n  <footer>\n    <p>This is an automated message. Please do not reply to this email. For any questions, kindly contact me through the email listed on <a href=\"https://www.qrz.com/db/BA4SAK\" target=\"_blank\">my QRZ page</a>.</p>\n  </footer>\n</body>\n</html>\n","options":{}},"type":"n8n-nodes-base.emailSend","typeVersion":2.1,"position":[1088,608],"id":"7d1a458e-8cc1-4802-9275-0aed9e5ebae2","name":"通知寄件人","webhookId":"59137653-36bb-4c2e-be16-7b5173fb18fe","credentials":{"smtp":{"id":"Jb9MEB3Hd3vMBzGg","name":"SMTP account"}}},{"parameters":{"resource":"databasePage","operation":"update","pageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"propertiesUi":{"propertyValues":[{"key":"收-发送状态|status","statusValue":"已发送"}]},"options":{}},"type":"n8n-nodes-base.notion","typeVersion":2.2,"position":[864,800],"id":"66de050a-d764-4e03-93db-af7ea845e103","name":"更新notion寄件人数据","alwaysOutputData":true,"retryOnFail":true,"maxTries":5,"credentials":{"notionApi":{"id":"PAx2VdaqwdzdGW6F","name":"Notion"}}},{"parameters":{"resource":"databasePage","operation":"update","pageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"propertiesUi":{"propertyValues":[{"key":"发送状态|status","statusValue":"已发送"}]},"options":{}},"type":"n8n-nodes-base.notion","typeVersion":2.2,"position":[864,112],"id":"643de07e-c3d0-49c6-be29-5a6a60540c5e","name":"更新notion收件人数据","alwaysOutputData":true,"retryOnFail":true,"maxTries":5,"credentials":{"notionApi":{"id":"PAx2VdaqwdzdGW6F","name":"Notion"}}}],"pinData":{},"connections":{"Schedule Trigger":{"main":[[{"node":"获取数据源","type":"main","index":0}]]},"通知收信人":{"main":[[]]},"整合收件人数据":{"main":[[{"node":"过滤收件人数据","type":"main","index":0}]]},"获取数据源":{"main":[[{"node":"整合收件人数据","type":"main","index":0},{"node":"过滤更改收件人数据","type":"main","index":0},{"node":"过滤更改收件人数据1","type":"main","index":0}]]},"过滤更改收件人数据":{"main":[[{"node":"更新notion收件人数据","type":"main","index":0}]]},"过滤收件人数据":{"main":[[{"node":"通知收信人","type":"main","index":0},{"node":"Code","type":"main","index":0}]]},"任务成功通知我":{"main":[[]]},"Code":{"main":[[{"node":"任务成功通知我","type":"main","index":0}]]},"过滤更改收件人数据1":{"main":[[{"node":"整合收件人数据1","type":"main","index":0},{"node":"更新notion寄件人数据","type":"main","index":0}]]},"整合收件人数据1":{"main":[[{"node":"通知寄件人","type":"main","index":0}]]},"更新notion收件人数据":{"main":[[]]}},"active":true,"settings":{"executionOrder":"v1"},"versionId":"e16bf8c6-8f37-417c-b840-6e4dbe780320","meta":{"templateCredsSetupCompleted":true,"instanceId":"14a748d0f67b4597622bf832bf86b08bf5316ab1d17e9782e700d4bffc13bd46"},"id":"rkM1e0FrmX1W1FUw","tags":[]}